<div class="chat-layout d-flex vh-100">
    <!-- Side Panel -->
    <aside class="side-panel bg-light border-end p-3 d-flex flex-column align-items-center" style="width:320px;">
        <div class="side-panel-header w-100 mb-3">
            <app-chat-mode-selector (modeSelected)="onModeSelected($event)"></app-chat-mode-selector>
            <app-model-selector (modelSelected)="onModelChange($event)"></app-model-selector>
        </div>
        <div class="model-details text-center mt-3" *ngIf="selectedModelDetails">
            <img *ngIf="selectedModelDetails.logoUrl" [src]="selectedModelDetails.logoUrl"
                [alt]="selectedModelDetails.name" class="model-logo mb-2 rounded" />
            <div class="model-name fw-bold fs-5">{{ selectedModelDetails.name }}</div>
            <div class="model-company text-muted fst-italic">{{ selectedModelDetails.company }}</div>
            <div class="model-description small text-start mt-2">{{ selectedModelDetails.description }}</div>
            <div class="text-start w-100">
                <a *ngIf="selectedModelDetails.referenceLink" [href]="selectedModelDetails.referenceLink"
                    class="d-inline-block mt-2 small text-decoration-underline text-primary model-link" target="_blank"
                    rel="noopener">
                    {{selectedModelDetails.referralSource}} - Reference
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Chat Area -->
    <div class="chat-container flex-grow-1 d-flex flex-column p-4">
        <div class="chat-history flex-grow-1 overflow-auto bg-white p-3 rounded mb-3">
            <div *ngIf="chatHistory.length === 0 && !isLoading && !errorMessage"
                class="no-messages text-center text-secondary fst-italic">
                No Messages found
            </div>
            <div *ngFor="let msg of chatHistory" [ngClass]="msg.role">
                <div class="message">
                    <strong *ngIf="msg.role === 'user'" class="text-primary">You:</strong>
                    <strong *ngIf="msg.role === 'assistant'" class="text-success">Bot:</strong>
                    <br />
                    <span class="message-content d-block" [innerHTML]="parseMarkdown(msg.content)"></span>
                    <div class="message-meta text-end fst-italic text-muted small">
                        {{ msg.dateTime | date:'short' }}
                    </div>
                </div>
            </div>
            <div *ngIf="isLoading" class="message bot">
                <app-typing-indicator></app-typing-indicator>
            </div>
        </div>
        <form class="input-bar d-flex align-items-center bg-light p-2 rounded border" (ngSubmit)="sendMessage()">
            <input class="form-control me-2" type="text" [(ngModel)]="userMessage" name="userMessage"
                [disabled]="isLoading" (keydown.enter)="sendMessage()" placeholder="Type your message..."
                autocomplete="off" />
            <button class="btn btn-primary" type="submit" [disabled]="isLoading || !userMessage.trim()">Send</button>
        </form>
        <div *ngIf="errorMessage" class="error text-danger text-center mt-2">{{ errorMessage }}</div>
    </div>
</div>